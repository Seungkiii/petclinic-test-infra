# =============================================================================
# Terraform Backend Configuration (예시 파일)
# 
# 사용 방법:
# 1. 이 파일을 backend.tf로 복사하거나
# 2. terraform init 시 -backend-config 옵션 사용
#
# 주의: backend.tf는 terraform init 전에 설정해야 합니다.
#       이미 로컬 state가 있는 경우 마이그레이션이 필요합니다.
# =============================================================================

terraform {
  backend "s3" {
    # S3 버킷 이름 (전역적으로 고유해야 함)
    bucket = "petclinic-terraform-state-prod-ap-northeast-2"

    # State 파일의 키 (경로)
    key = "terraform.tfstate"

    # AWS 리전
    region = "ap-northeast-2"

    # 암호화 사용 (선택적, 기본값: false)
    encrypt = true

    # KMS 키 ID (선택적, 기본 AES256 암호화 사용)
    # kms_key_id = "arn:aws:kms:ap-northeast-2:123456789012:key/12345678-1234-1234-1234-123456789012"

    # State 파일 버전 관리 (선택적, 기본값: false)
    # S3 버킷에서 버전 관리가 활성화되어 있어야 함
    # versioning = true  # Terraform 1.10.0 이상에서 지원

    # S3 파일 기반 락킹 사용 (Terraform 1.10.0 이상)
    # DynamoDB 테이블 없이 S3의 파일 기반 락킹 메커니즘 사용
    # Object Lock과 함께 사용하면 더욱 안전한 락킹 제공
    use_lockfile = true
    
    # State 파일 접두사 (선택적)
    # prefix = "prod/"

    # AWS 프로파일 (선택적, 기본값: default)
    # profile = "default"

    # AWS 자격 증명 파일 경로 (선택적)
    # shared_credentials_file = "~/.aws/credentials"

    # State 파일 액세스 로깅 (선택적)
    # access_logging {
    #   bucket = "terraform-state-logs"
    #   prefix = "state-access-logs/"
    # }
  }
}

# =============================================================================
# Backend 마이그레이션 방법
# =============================================================================
#
# 기존 로컬 state를 S3로 마이그레이션:
#
# 1. backend.tf 파일 생성 (위 설정 사용)
# 2. terraform init 실행
# 3. "Migrate state to S3?" 질문에 "yes" 입력
#
# 또는 명령어로:
# terraform init -migrate-state
#
# =============================================================================
#
# Backend 설정 변경:
#
# 1. backend.tf 파일 수정
# 2. terraform init -reconfigure 실행
#
# =============================================================================

